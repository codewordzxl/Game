#include "Game.h"
#include <stdlib.h>
#include "stdio.h"

extern flag;

char txt[16];

uint Player1_flag=0;//玩家1状态标志
uint Player2_flag=0;//玩家2状态标志

uint Player1_mark=0;//玩家1得分
uint Player2_mark=0;//玩家2得分

uint count=1;//游戏局数


unsigned char code BMP1[] =
{
/*--  调入了一幅图像：D:\桌面\1.bmp  --*/
/*--  宽度x高度=128x64  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF0,0x38,0x1C,0x0C,0x0E,
0x06,0x0E,0x0C,0x1C,0x38,0xF0,0xE0,0x80,0x00,0x00,0x00,0x00,0x00,0x70,0xF0,0xF0,
0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x38,0xF8,0xF8,0x38,0x38,0x38,0x38,
0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x00,0xF0,0xF0,0x70,0x70,0x70,0x70,0x7C,0x7E,
0x7C,0x70,0x70,0x70,0x70,0xF0,0xF0,0x00,0x00,0xE0,0xE0,0xF0,0xF8,0xF8,0x00,0x00,
0x00,0x70,0xF0,0x70,0x70,0xFE,0xFE,0x70,0x70,0x70,0xFE,0xFE,0x70,0x70,0x70,0x70,
0x70,0xF8,0xF8,0x18,0xF8,0xF8,0x00,0xF8,0xF8,0x80,0xFC,0xFC,0x80,0x80,0x80,0x80,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xCE,0xCF,0x0E,0x00,
0x00,0x00,0x00,0xCF,0xCE,0x00,0x83,0xFF,0x00,0xCC,0xFC,0xFC,0x70,0x70,0xFF,0xFF,
0xFF,0xFE,0x70,0x70,0x70,0x70,0x70,0x30,0x1C,0x1C,0xFF,0xFF,0x1C,0x1C,0x0C,0xFC,
0xFC,0x0C,0x0C,0xFC,0xFC,0x0C,0x0C,0x0C,0xC1,0xE1,0xE7,0x77,0xBF,0xFF,0xFF,0xFF,
0xE7,0xE7,0xE7,0xF7,0x3F,0x3F,0x01,0x00,0x00,0x01,0x00,0xFF,0xFF,0xFF,0x00,0x00,
0x20,0xE1,0x77,0xBF,0xFE,0xFF,0x37,0x30,0x30,0x30,0xFF,0xFF,0x33,0x37,0x3E,0x34,
0x00,0xFF,0xFF,0xC6,0xFF,0xFF,0x1E,0xFF,0xE3,0xE1,0xFF,0xFF,0xE1,0xE1,0xE1,0xC1,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x0F,0x1C,0x39,0x77,0xEF,0xCE,
0xCC,0xCC,0xCE,0x67,0x71,0x3C,0x0F,0x03,0x00,0x00,0x00,0x00,0x00,0x78,0x7F,0x3F,
0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x38,0x1F,0x1F,0xCE,0xEE,0xF8,0x7F,
0x0F,0x00,0x00,0xFF,0xFF,0xE0,0xFC,0x7C,0xEC,0xEE,0xFF,0x77,0xFB,0xDD,0xCE,0xE7,
0xFF,0x7F,0x03,0x0F,0x3E,0x7C,0x78,0x30,0x00,0x00,0x00,0x3F,0x3F,0x3F,0x00,0x00,
0x00,0x5C,0xDE,0xCF,0xE3,0xFF,0xFF,0xE0,0xF8,0x3F,0x0F,0x0F,0x3F,0xF8,0xF0,0xC0,
0xC0,0xFF,0xFF,0xC1,0xFF,0xFF,0xE0,0xE0,0xE0,0xE0,0xFF,0xFF,0xE0,0xE0,0xE0,0xE0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,
0x00,0x01,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

};

unsigned char code BMP2[] =
{
	/*--  调入了一幅图像：D:\桌面\1.bmp  --*/
/*--  宽度x高度=128x64  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,
0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xC0,0xF8,0x3C,0x0E,0xE7,0xE3,0xC3,0x01,0x01,0x01,0x01,0xE3,0xE3,0xC6,
0x1E,0x7C,0xF0,0x00,0x86,0x86,0xFE,0xFE,0x86,0x86,0xC0,0xC6,0xC6,0xC6,0xC6,0xC6,
0xC6,0xC6,0xC6,0xC6,0xC0,0x00,0x3C,0x3C,0x6C,0x6C,0x6C,0xEC,0xED,0xEF,0x6F,0x6F,
0x6C,0x6C,0x6C,0xEC,0xFC,0x3C,0x3C,0x00,0x1C,0x0E,0x06,0x07,0x07,0x8E,0xFE,0xFC,
0x78,0x0E,0x2E,0x7E,0xEE,0xCE,0xFF,0xFF,0x2E,0x0E,0x0E,0x0E,0xFF,0xFF,0x7F,0x6E,
0xEE,0xCE,0x0E,0x00,0xFF,0xFF,0xE7,0xE7,0xFF,0xFF,0xF0,0xFF,0x3E,0x30,0xFF,0xFF,
0xFF,0x30,0x30,0x30,0x30,0x00,0x80,0x80,0x80,0x00,0x0E,0xFE,0xFC,0xF8,0xE0,0x80,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x0F,0x3F,0xF0,0xC0,0x9C,0x3C,0x70,0x60,0x60,0x60,0x60,0x70,0x3C,0x8C,
0xE0,0xF8,0x3F,0x03,0xC1,0xC1,0xFF,0xFF,0x61,0x71,0xF1,0xE1,0xFF,0x3F,0x01,0x01,
0xFF,0xFF,0x01,0x81,0xE1,0xE4,0xEC,0x6E,0xFE,0xB7,0xFF,0xFF,0xEF,0x7F,0xFF,0xFC,
0xEE,0x3E,0xFF,0xE7,0xC3,0x80,0x80,0x00,0xF0,0xF8,0xFC,0xDE,0xCF,0xC7,0xC3,0xC1,
0xC0,0xC6,0xEE,0xF7,0x7B,0x3F,0xFF,0xFC,0x07,0x87,0xC7,0xF7,0xFF,0x7F,0xFF,0xC7,
0x87,0x07,0x07,0x00,0xFF,0xFF,0x1C,0x1C,0xFF,0xFF,0x03,0x0F,0x0C,0x0C,0xFF,0xFF,
0xFF,0x0C,0x0C,0x0C,0x00,0x00,0x0F,0x0F,0x07,0x07,0x87,0xFF,0xFF,0x7F,0x3F,0x0F,
0x07,0x07,0x07,0x07,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x03,0x07,0x06,0x06,0x06,0x06,0x07,0x03,0x01,
0x01,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x0E,0x0F,0x07,0x03,0x01,0x00,0x00,0x00,
0x07,0x07,0x06,0x07,0x07,0x03,0x07,0x07,0x03,0x03,0x07,0x07,0x06,0x06,0x07,0x07,
0x01,0x00,0x00,0x01,0x01,0x03,0x03,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x00,0x02,0x06,0x06,0x07,0x07,0x07,0x0F,0x07,0x03,0x01,0x00,0x00,0x01,0x03,
0x07,0x0F,0x06,0x06,0x0F,0x07,0x06,0x06,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
0x07,0x07,0x07,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x01,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

};

unsigned char xdata OLED_GRAM[101][8]={0};

uint Time_Down=180;//贪吃蛇倒计时

uchar x1;
uchar y1;
uchar x2;
uchar y2;

extern DisSnake_flag;

//蛇的结构体
struct Snake
{
   uchar  x[30];
   uchar  y[30];
   uchar Node;                    //    蛇的节数
   uchar Direction;               //    蛇移动方向
}Snake1;

struct snake
{
   uchar  x[30];
   uchar  y[30];
   uchar Node;                    //    蛇的节数
   uchar Direction;               //    蛇移动方向
}Snake2;


//食物结构体
struct Food
{
   uchar x;                        //    食物的横坐标
   uchar y;                        //    食物的纵坐标
}food;

//
uchar Snake1_Die=0;
uchar Snake2_Die=0;

struct Ball
{
   uchar x;                        //    球的横坐标
   uchar y;                        //    球的纵坐标

   uchar x_D;
   uchar y_D;
}ball;

uchar D_x;//球的久坐标
uchar D_y;

uchar DisBoard_flag;

void Game1()
{	
	OLED_CLS();

	Player1_flag=0;//玩家1状态标志
	Player2_flag=0;//玩家2状态标志

	Player1_mark=0;//玩家1得分
	Player2_mark=0;//玩家2得分

	count=1;//游戏局数

	Led1=0;
	Led2=0;

	while(flag)
	{
		Key();
		Display();	
		Result();
	   	Mark();

		if(Player1_mark==3)
		{
		   	flag=0;

			OLED_CLS();
			Draw_BMP(0,0,128,8,BMP1);

			Delay1ms(10000);
		}

		if(Player2_mark==3)
		{
			flag=0;

			OLED_CLS();
			Draw_BMP(0,0,128,8,BMP2);

			Delay1ms(10000);
		}
	}	
}

void Key()
{
	//玩家1键盘
  	if(Player1_U==0||Player1_L==0||Player1_D==0||Player1_R==0)
		{
		  	Delay1ms(100);

		   if(Player1_U==0)
		   {
			   	Player1_flag=2;

				Led1=1;
		   }

		   else if(Player1_L==0)
		   {
			   	Player1_flag=1;

				Led1=1;
		   }

		   else if(Player1_D==0)
		   {
				Player1_flag=rand()%3+1;

				Led1=1;
		   }

		   else if(Player1_R==0)
		   {
				Player1_flag=3;

				Led1=1;
		   }
		}

		if(Player2_U==0||Player2_L==0||Player2_D==0||Player2_R==0)
		{
		  	Delay1ms(100);

		   if(Player2_U==0)
		   {
			   	Player2_flag=2;

				Led2=1;
		   }

		   else if(Player2_L==0)
		   {
			   	Player2_flag=1;

				Led2=1;
		   }

		   else if(Player2_D==0)
		   {
				Player2_flag=rand()%3+1;

				Led2=1;
		   }

		   else if(Player2_R==0)
		   {
				Player2_flag=3;

				Led2=1;
		   }
		}

}
void Display()
{
	//局数显示
	 OLED_P16x16Ch(0,1,24);

	 sprintf(txt,"%d",count);
     OLED_P8x16Str(16,1,(uchar *)txt);

	 OLED_P16x16Ch(38,1,25);
	 OLED_P16x16Ch(54,1,23);
}

void Mark()//得分：
{
	OLED_P16x16Ch(0,6,21);
	OLED_P16x16Ch(16,6,22);
	OLED_P16x16Ch(31,6,23);

	sprintf(txt,"%d",Player1_mark);
    OLED_P8x16Str(63,6,(uchar *)txt);

	sprintf(txt,"%d",Player2_mark);
    OLED_P8x16Str(95,6,(uchar *)txt);
}

void Result()
{
	if(Player1_flag!=0&&Player2_flag!=0)
	{
		//玩家1图形
		 if(Player1_flag==1)
		 {
			  OLED_P16x16Ch(0,3,26);
		 }
	
		 if(Player1_flag==2)
		 {
			  OLED_P16x16Ch(0,3,27);
		 }
		 if(Player1_flag==3)
		 {
			   OLED_P16x16Ch(0,3,28);
		 }
	
		//玩家2图形
		 if(Player2_flag==1)
		 {
				OLED_P16x16Ch(111,3,26);
		 }
	
		 if(Player2_flag==2)
		 {
				OLED_P16x16Ch(111,3,27);
		 }
		 if(Player2_flag==3)
		 {
				 OLED_P16x16Ch(111,3,28);
		 }


	  	if(Player1_flag==Player2_flag)//平局
		{
			 OLED_P16x16Ch(31,3,31);
			 OLED_P16x16Ch(47,3,29);
			 OLED_P16x16Ch(63,3,25);
			 OLED_P16x16Ch(79,3,31);

			 Player1_flag=0;
			 Player2_flag=0;

			 Led1=0;
			 Led2=0;

			 count++;

			 Delay1ms(5000);

		}
		
		else if((Player1_flag==1&&Player2_flag==2)||(Player1_flag==2&&Player2_flag==3)||(Player1_flag==3&&Player2_flag==1))//玩家1胜利
		{
			OLED_P16x16Ch(31,3,8);
			OLED_P16x16Ch(47,3,9);
			OLED_P16x16Ch(63,3,10);
			OLED_P16x16Ch(79,3,30);

			Player1_flag=0;
			Player2_flag=0;

			Led1=0;
			Led2=0;

			count++;
			Player1_mark++;

			Delay1ms(5000);
		}

		else if((Player1_flag==1&&Player2_flag==3)||(Player1_flag==2&&Player2_flag==1)||(Player1_flag==3&&Player2_flag==2))//玩家2胜利
		{
			OLED_P16x16Ch(31,3,8);
			OLED_P16x16Ch(47,3,9);
			OLED_P16x16Ch(63,3,11);
			OLED_P16x16Ch(79,3,30);

			Player1_flag=0;
			Player2_flag=0;

			Led1=0;
			Led2=0;

			count++;
			Player2_mark++;

			Delay1ms(5000);
		}
	}
	else
	{
		OLED_P16x16Ch(0,3,32);

		OLED_P16x16Ch(31,3,32);
		OLED_P16x16Ch(47,3,32);
		OLED_P16x16Ch(63,3,32);
		OLED_P16x16Ch(79,3,32);

		OLED_P16x16Ch(111,3,32);
	}
}

/***************************************************贪吃蛇*******************************************************/
void Game2()
{
	Time_Down=180;

	Player1_mark=0;//玩家1得分
	Player2_mark=0;//玩家2得分

	Snake1_Die=0;
	Snake2_Die=0;

	Clear();

	OLED_CLS();

	Farme();

	Snake_Init();

	Make_Food();

	Display_Snake();


	OLED_Refresh_Gram();

	Time();

	Snake_Move();


	TMOD=0x01;//T0工作于方式1
	TH0 = 0x0D8;
    TL0 = 0x0F0;
    EA = 1;
    ET0 = 1;
    TR0 = 1;

	while(flag)
	{
		Key_Direct();
		Die();

		if(Snake1.x[0]==food.x&&Snake1.y[0]==food.y)
		{
		   Snake1.Node++;
		   Player1_mark++;
		   Make_Food();
		}

		if(Snake2.x[0]==food.x&&Snake2.y[0]==food.y)
		{
		   Snake2.Node++;
		   Player2_mark++;
		   Make_Food();
		}

		if(DisSnake_flag)
		{
		 	Time();
			Farme();
		 	Display_Snake();
		 	OLED_Refresh_Gram();
		} 
		
		if((Snake1_Die==0&&Snake2_Die==1)||Player1_mark==20)//玩家1获胜
		{
		  	flag=0;

			ET0 = 0;
    		TR0 = 0;

			OLED_CLS();
			Draw_BMP(0,0,128,8,BMP1);

			Delay1ms(10000);
		} 

		if((Snake1_Die==1&&Snake2_Die==0)||Player2_mark==20)//玩家2获胜
		{
		  	flag=0;

			ET0 = 0;
    		TR0 = 0;

			OLED_CLS();
			Draw_BMP(0,0,128,8,BMP2);

			Delay1ms(10000);
		}

		if((Snake1_Die==1&&Snake2_Die==1)||Time_Down==0)//同时死亡
		{
			ET0 = 0;
    		TR0 = 0;

			if(Player1_mark>Player2_mark)
			{
			   	flag=0;

				OLED_CLS();
				Draw_BMP(0,0,128,8,BMP1);
		
				Delay1ms(10000);
			}
			else if(Player1_mark<Player2_mark)
			{
				flag=0;

				OLED_CLS();
				Draw_BMP(0,0,128,8,BMP2);
	
				Delay1ms(10000);
			}
			else
			{
			   	flag=0;
				OLED_CLS();
				OLED_P16x16Ch(31,3,31);
			 	OLED_P16x16Ch(47,3,29);
			 	OLED_P16x16Ch(63,3,25);
			 	OLED_P16x16Ch(79,3,31);
				Delay1ms(10000);
			}
		  	
		}

	}

	ET0 = 0;
    TR0 = 0;

}

void OLED_Refresh_Gram(void)
{
    uchar i,n;
	         
    for(i=0;i<8;i++)  
    {  
			OLED_Set_Pos(2,i);
		
        for(n=0;n<101;n++)
		{
			OLED_WrDat(OLED_GRAM[n][i]);      //写数据
		}
    }   
}
///*************************************************************************/
void OLED_DrawPoint(uchar x,uchar y,uchar t)
{
    uchar pos,bx,temp=0;
    if(x>127||y>63)return;            //超出范围
    pos=y/8;
    bx=y%8;
    temp=1<<(bx);
    if(t)OLED_GRAM[x][pos]|=temp;
    else OLED_GRAM[x][pos]&=~temp;     
}

//画线
//x:0~128
//y:0~64
void OLED_DrawLine(uchar x1,uchar y1,uchar x2,uchar y2)
{
	uchar i,k,k1,k2;
	if(x1==x2)    //画竖线
	{
			for(i=0;i<(y2-y1);i++)
			{
				OLED_DrawPoint(x1,y1+i,1);
			}
  }
	else if(y1==y2)   //画横线
	{
			for(i=0;i<(x2-x1);i++)
			{
				OLED_DrawPoint(x1+i,y1,1);
			}
  }
	else      //画斜线
	{
		k1=y2-y1;
		k2=x2-x1;
		k=k1*10/k2;//斜率
		for(i=0;i<(x2-x1);i++)
			{
			  OLED_DrawPoint(x1+i,y1+i*k/10,1);
			}
	}
}

void Farme()//边框显示
{
	OLED_DrawLine(0,1,100,1);//上横
	OLED_DrawLine(0,63,100,63);//下横
	OLED_DrawLine(0,1,0,63);//左竖
	OLED_DrawLine(100,1,100,63);//右竖
}

void Time()//时间、得分显示
{
   	sprintf(txt,"%d",Time_Down);
    OLED_P8x16Str(104,0,(uchar *)txt);
	if(Time_Down<100)
	{
		OLED_P8x16_Mie(120,0);
	}
	if(Time_Down<10)
	{
		OLED_P8x16_Mie(112,0);
	}

	sprintf(txt,"%d",Player1_mark);
    OLED_P8x16Str(104,3,(uchar *)txt);

	sprintf(txt,"%d",Player2_mark);
    OLED_P8x16Str(104,6,(uchar *)txt);

	if(Time_Down==0)//关闭定时器
	{
		ET0 = 0;
    	TR0 = 0;
	}
}
void Snake_Init()
{
	 Snake1.x[0]=10;
	 Snake1.y[0]=20;

	 Snake1.x[1]=9;
	 Snake1.y[1]=20;

	 Snake1.x[2]=8;
	 Snake1.y[2]=20;

	 Snake1.x[3]=7;
	 Snake1.y[3]=20;

	 Snake1.x[4]=6;
	 Snake1.y[4]=20;

	 Snake1.Node=5;
	 Snake1.Direction=4;

	 Snake2.x[0]=90;
	 Snake2.y[0]=40;

	 Snake2.x[1]=91;
	 Snake2.y[1]=40;

	 Snake2.x[2]=92;
	 Snake2.y[2]=40;

	 Snake2.x[3]=93;
	 Snake2.y[3]=40;

	 Snake2.x[4]=94;
	 Snake2.y[4]=40;

	 Snake2.Node=5;
	 Snake2.Direction=2;
}

void Snake_Move()
{
	uchar i;
	//1号蛇
	x1=Snake1.x[Snake1.Node-1];
	y1=Snake1.y[Snake1.Node-1];

	for(i=Snake1.Node-1;i>0;i--)
	{
		Snake1.x[i]=Snake1.x[i-1];
		Snake1.y[i]=Snake1.y[i-1];
	}
	if(Snake1.Direction==1)
	{
		Snake1.x[0]=Snake1.x[1];
		Snake1.y[0]=Snake1.y[1]-1;
	}
	else if(Snake1.Direction==2)
	{
		Snake1.x[0]=Snake1.x[1]-1;
		Snake1.y[0]=Snake1.y[1];
	}
	else if(Snake1.Direction==3)
	{
		Snake1.x[0]=Snake1.x[1];
		Snake1.y[0]=Snake1.y[1]+1;
	}
	else if(Snake1.Direction==4)
	{
		Snake1.x[0]=Snake1.x[1]+1;
		Snake1.y[0]=Snake1.y[1];
	}

	//2号蛇

	x2=Snake2.x[Snake2.Node-1];
	y2=Snake2.y[Snake2.Node-1];

	for(i=Snake2.Node-1;i>0;i--)
	{
		Snake2.x[i]=Snake2.x[i-1];
		Snake2.y[i]=Snake2.y[i-1];
	}
	if(Snake2.Direction==1)
	{
		Snake2.x[0]=Snake2.x[1];
		Snake2.y[0]=Snake2.y[1]-1;
	}
	else if(Snake2.Direction==2)
	{
		Snake2.x[0]=Snake2.x[1]-1;
		Snake2.y[0]=Snake2.y[1];
	}
	else if(Snake2.Direction==3)
	{
		Snake2.x[0]=Snake2.x[1];
		Snake2.y[0]=Snake2.y[1]+1;
	}
	else if(Snake2.Direction==4)
	{
		Snake2.x[0]=Snake2.x[1]+1;
		Snake2.y[0]=Snake2.y[1];
	}

	DisSnake_flag=1;
}

void Display_Snake()
{
   	  uchar i;

	  OLED_DrawPoint(x1,y1,0);
	  for(i=0;i<Snake1.Node;i++)
	  {
			OLED_DrawPoint(Snake1.x[i],Snake1.y[i],1);	
	  }
	  
	  OLED_DrawPoint(x2,y2,0);
	  for(i=0;i<Snake2.Node;i++)
	  {
			OLED_DrawPoint(Snake2.x[i],Snake2.y[i],1);	
	  }
	  
	  OLED_DrawPoint(food.x,food.y,1);

	  DisSnake_flag=0;
	  
}

void  Key_Direct()
{
	//玩家1键盘
  	if(Player1_U==0||Player1_L==0||Player1_D==0||Player1_R==0)
	{
	  	Delay1ms(100);

	   if(Player1_U==0)
	   {
	   		if(Snake1.Direction!=3)
			{
		 		Snake1.Direction=1;
			}
	   }

	   else if(Player1_L==0)
	   {
		   	if(Snake1.Direction!=4)
			{
		 		Snake1.Direction=2;
			}
	   }

	   else if(Player1_D==0)
	   {
			if(Snake1.Direction!=1)
			{
		 		Snake1.Direction=3;
			}
	   }

	   else if(Player1_R==0)
	   {
			if(Snake1.Direction!=2)
			{
		 		Snake1.Direction=4;
			}
	   }
	}

	if(Player2_U==0||Player2_L==0||Player2_D==0||Player2_R==0)
	{
	  	Delay1ms(100);

	   if(Player2_U==0)
	   {
		   	if(Snake2.Direction!=3)
			{
		 		Snake2.Direction=1;
			}
	   }

	   else if(Player2_L==0)
	   {
		   	if(Snake2.Direction!=4)
			{
		 		Snake2.Direction=2;
			}
	   }

	   else if(Player2_D==0)
	   {
			if(Snake2.Direction!=1)
			{
		 		Snake2.Direction=3;
			}
	   }

	   else if(Player2_R==0)
	   {
			if(Snake2.Direction!=2)
			{
		 		Snake2.Direction=4;
			}
	   }
	}
}

void Make_Food()
{
	uchar i,Node_Max;
	food.x=rand()%99+1;
	food.y=rand()%60+2;

	if(Snake1.Node>=Snake2.Node)
	{
		Node_Max=Snake1.Node;
	}
	else
	{
	 	Node_Max=Snake2.Node;
	}
	
	for(i=0;i<Node_Max;i++)
	{
	   	if((Snake1.x[i]==food.x&&Snake1.y[i]==food.y)||(Snake2.x[i]==food.x&&Snake2.y[i]==food.y))
		{
		   	food.x=rand()%99+1;
			food.y=rand()%60+2;

			i=0;
		}
	}

}

void Die()
{
	uchar i;
	//****************撞墙*********************************************
	if(Snake1.x[0]==0||Snake1.x[0]==100||Snake1.y[0]==1||Snake1.y[0]==63)
	{
		 Snake1_Die=1;
	}

	if(Snake2.x[0]==0||Snake2.x[0]==100||Snake2.y[0]==1||Snake2.y[0]==63)
	{
		 Snake2_Die=1;
	}

	//*****************咬蛇**********************************************
	//1号蛇
	for(i=1;i<Snake1.Node;i++)
	{
	   	if(Snake1.x[0]==Snake1.x[i]&&Snake1.y[0]==Snake1.y[i])
		{
			Snake1_Die=1;
		}
	}

	for(i=0;i<Snake2.Node;i++)
	{
	   	if(Snake1.x[0]==Snake2.x[i]&&Snake1.y[0]==Snake2.y[i])
		{
			Snake1_Die=1;
		}
	}
	
	//2号蛇
	for(i=1;i<Snake2.Node;i++)
	{
	   	if(Snake2.x[0]==Snake2.x[i]&&Snake2.y[0]==Snake2.y[i])
		{
			Snake2_Die=1;
		}
	}

	for(i=0;i<Snake1.Node;i++)
	{
	   	if(Snake2.x[0]==Snake1.x[i]&&Snake2.y[0]==Snake1.y[i])
		{
			Snake2_Die=1;
		}
	}

}

void Clear()//数组清空
{
  	uchar i,j;

	for(i=0;i<101;i++)
	{
	   for(j=0;j<64;j++)
	   {
		   OLED_DrawPoint(i,j,0);
	   }
	}

	for(i=0;i<30;i++)
	{
	 	Snake1.x[i]=0;
		Snake1.y[i]=0;
		Snake2.x[i]=0;
		Snake2.y[i]=0;
	}
}

/********************************************************乒乓球***************************************************************/
void Game3()
{
	Clear();

	OLED_CLS();

	Farme();

	Board_Init();

	Display_Board();

	OLED_Refresh_Gram();

	TMOD=0x01;//T0工作于方式1
	TH0 = 0x0D8;
    TL0 = 0x0F0;
    EA = 1;
    ET0 = 1;
    TR0 = 1;

	while(flag)
	{
		Key_Board();

		if(DisBoard_flag)
		{
			Farme();
		 	Display_Board();
		 	OLED_Refresh_Gram();
		}

		if(ball.x==10)
		{
			flag=0;

			ET0 = 0;
    		TR0 = 0;

			OLED_CLS();
			Draw_BMP(0,0,128,8,BMP2);

			Delay1ms(10000);
		}

		if(ball.x==90)
		{
			flag=0;

			ET0 = 0;
    		TR0 = 0;

			OLED_CLS();
			Draw_BMP(0,0,128,8,BMP1);

			Delay1ms(10000);
		}


	}

	ET0 = 0;
    TR0 = 0;

}

void Board_Init()
{
	Snake1.x[0]=10;
	 Snake1.y[0]=27;
	
	 Snake1.x[1]=10;
	 Snake1.y[1]=28;
	
	 Snake1.x[2]=10;
	 Snake1.y[2]=29;
	
	 Snake1.x[3]=10;
	 Snake1.y[3]=30;
	
	 Snake1.x[4]=10;
	 Snake1.y[4]=31;

	 Snake1.x[5]=10;
	 Snake1.y[5]=32;
	
	 Snake1.x[6]=10;
	 Snake1.y[6]=33;
	
	 Snake1.x[7]=10;
	 Snake1.y[7]=34;
	
	 Snake1.x[8]=10;
	 Snake1.y[8]=35;
	
	 Snake1.x[9]=10;
	 Snake1.y[9]=36;
	
	 Snake1.Node=10;
	 Snake1.Direction=0;
	
	 Snake2.x[0]=90;
	 Snake2.y[0]=27;
	
	 Snake2.x[1]=90;
	 Snake2.y[1]=28;
	
	 Snake2.x[2]=90;
	 Snake2.y[2]=29;
	
	 Snake2.x[3]=90;
	 Snake2.y[3]=30;
	
	 Snake2.x[4]=90;
	 Snake2.y[4]=31;

	 Snake2.x[5]=90;
	 Snake2.y[5]=32;
	
	 Snake2.x[6]=90;
	 Snake2.y[6]=33;
	
	 Snake2.x[7]=90;
	 Snake2.y[7]=34;
	
	 Snake2.x[8]=90;
	 Snake2.y[8]=35;
	
	 Snake2.x[9]=90;
	 Snake2.y[9]=36;
	
	 Snake2.Node=10;
	 Snake2.Direction=0;

	 ball.x=12;
	 ball.y=30;
	 ball.x_D=1;
	 ball.y_D=1;

}

void Display_Board()
{
   	  uchar i;

	  OLED_DrawPoint(x1,y1,0);
	  for(i=0;i<Snake1.Node;i++)
	  {
			OLED_DrawPoint(Snake1.x[i],Snake1.y[i],1);	
	  }
	  
	  OLED_DrawPoint(x2,y2,0);
	  for(i=0;i<Snake2.Node;i++)
	  {
			OLED_DrawPoint(Snake2.x[i],Snake2.y[i],1);	
	  }

	  DisBoard_flag=0;

	  OLED_DrawPoint(D_x,D_y,0);

	  OLED_DrawPoint(ball.x,ball.y,1);
	  
}

void Key_Board()
{
  	if(Player1_U==0)
	{
		Snake1.Direction=5;//上
	}
	else if(Player1_D==0)
	{
		Snake1.Direction=6;//下
	}
	else 
	{
		Snake1.Direction=0;
	}

	if(Player2_U==0)
	{
		Snake2.Direction=5;//上
	}
	else if(Player2_D==0)
	{
		Snake2.Direction=6;//下
	}
	else
	{
	  	Snake2.Direction=0;
	}
}

void B_Move()
{
	uchar i;
	if(DisBoard_flag==0)
	{
		if(Snake1.Direction==5&&Snake1.y[0]!=2)
		{
		   	x1=Snake1.x[Snake1.Node-1];
			y1=Snake1.y[Snake1.Node-1];
		
			for(i=Snake1.Node-1;i>0;i--)
			{
				Snake1.x[i]=Snake1.x[i-1];
				Snake1.y[i]=Snake1.y[i-1];
			}
	
			Snake1.x[0]=Snake1.x[1];
			Snake1.y[0]=Snake1.y[1]-1;
		}
	
		if(Snake1.Direction==6&&Snake1.y[Snake1.Node-1]!=62)
		{
		   	x1=Snake1.x[0];
			y1=Snake1.y[0];
		
			for(i=0;i<Snake1.Node-1;i++)
			{
				Snake1.x[i]=Snake1.x[i+1];
				Snake1.y[i]=Snake1.y[i+1];
			}
	
			Snake1.x[Snake1.Node-1]=Snake1.x[Snake1.Node-2];
			Snake1.y[Snake1.Node-1]=Snake1.y[Snake1.Node-2]+1;
		}
	
		if(Snake2.Direction==5&&Snake2.y[0]!=2)
		{
		   	x2=Snake2.x[Snake2.Node-1];
			y2=Snake2.y[Snake2.Node-1];
		
			for(i=Snake2.Node-1;i>0;i--)
			{
				Snake2.x[i]=Snake2.x[i-1];
				Snake2.y[i]=Snake2.y[i-1];
			}
	
			Snake2.x[0]=Snake2.x[1];
			Snake2.y[0]=Snake2.y[1]-1;
		}
	
		if(Snake2.Direction==6&&Snake2.y[Snake2.Node-1]!=62)
		{
		   	x2=Snake2.x[0];
			y2=Snake2.y[0];
		
			for(i=0;i<Snake2.Node-1;i++)
			{
				Snake2.x[i]=Snake2.x[i+1];
				Snake2.y[i]=Snake2.y[i+1];
			}
	
			Snake2.x[Snake2.Node-1]=Snake2.x[Snake2.Node-2];
			Snake2.y[Snake2.Node-1]=Snake2.y[Snake2.Node-2]+1;
		}

		D_x=ball.x;
		D_y=ball.y;
	
		if(ball.x_D==1)
		{
		  	ball.x+=1;
		}
		else
		{
			ball.x-=1;
		}
	
		if(ball.y_D==1)
		{
		   	ball.y+=1;
		}
		else
		{
		 	ball.y-=1;
		}

		if(ball.y==2)
		{
			ball.y_D=1;
		}

		if(ball.y==62)
		{
			ball.y_D=0;
		}

		if(ball.x==11)
		{
			for(i=0;i<Snake1.Node-1;i++)
			{
			   if(Snake1.y[i]==ball.y)
			   {
				  ball.x_D=1;
			   }
			}
		}

		if(ball.x==89)
		{
			for(i=0;i<Snake2.Node-1;i++)
			{
			   if(Snake2.y[i]==ball.y)
			   {
				  ball.x_D=0;
			   }
			}
		}
	
		DisBoard_flag=1;
	}

	
}